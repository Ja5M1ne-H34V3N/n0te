# 概述
前面两章，我们学习到了信息是怎么从一个主机传输到另一个主机的
也就是说，不管什么手段，把信息发给路由器，然后由路由器根据转发表转发，到对方主机
本章讲述的内容是：信息在各种设备之间传输的细节，原理是是什么，也就是更深入地，探究刚刚提到的“手段”都有什么

> [!解释]
> 比如说，从我的老家河北承德到地大未来城，我需要从我家，坐车到承德市火车站，然后通过高铁到达武汉站，在到达武汉站后，坐地铁到未来三路，最后从未来三路坐车到未来城
> 这个过程里，我们从宏观上看，是从我家到未来城校区，中间的承德站，武汉站，未来三路都是节点。承德站知道我到了后给我送到武汉站，武汉站知道把我送到未来三路……这像网络层的内容，每个节点为我指明了下一个目的地。然而，每个节点之间的具体的交通方式却不同，而这个交通方式就像不同的链路层协议：我是怎么在节点之间传送的，而且，无论采取什么方式，我们都实现了在节点之间移动

### 一些术语
节点：主机和路由器
链路：沿着通信路径连接相邻节点的通信信道，分为有线链路和无线链路
帧：数据在链路层的分组单元
 
**数据链路层负责将数据报通过链路从一个节点传输到物理上相邻的下一个节点**


### 数据流动的简单模型

![Pasted image 20251117213511](第六章——链路层/Pasted%20image%2020251117213511.png)
![Pasted image 20251117213519](第六章——链路层/Pasted%20image%2020251117213519.png)


### 链路层提供的服务
#### 成帧，链路访问
所谓成帧，就是在数据报上再添加一层链路层识别的头和尾，称为链路层传输的信息——数据帧
通过共享介质的信道访问
和IP地址不同，帧头部用mac地址表示源和目的

#### 可靠传递
很少使用误码率低的链路

#### 流量控制
在相邻的收发节点之间限制流量

#### 差错检测
信号衰减和电磁干扰会导致干扰噪声出错（~~这篇笔记编写的前一天，笔者看到彩六里面的EMP老爷子重做了~~）。在接收方检测到错误存在后，会进行差错纠正或向发送方发送信号要求重传

#### 差错纠正
接收方检测和纠正数据帧中的错误，无需重传

#### 半双工和全双工


### 链路层的实现
有下面的几种方式
1其硬件在每一台设备上，包括主机，交换机。路由器
2链路层在”适配器“（网卡NIC）或芯片上实现
3直接和主机的系统总线相连（有线上网）
是硬件，软件和固件的结合体

# 差错检测和纠正技术
就和网络层一样，传是传过来了，但是要确认一下有没有传错
## 差错检测模型
EDC = Error Detection and Correction Bits 差错检测和纠错比特
D = Data 差错检测位保护的数据
简单来说，就是D能经过一种变换得到EDC，而在接收方收到整个数据帧后，将D按照同样的方法变换一次，如果不等于发来的EDC，则说明出问题了，几种集中检验的方式如下
### 单比特奇偶校验
假设这一段数据帧有这些信息
![Pasted image 20251117215734](第六章——链路层/Pasted%20image%2020251117215734.png)
那么，发送方会在这串数据的末尾添加一位二进制数，让所有二进制数中1的个数是偶数
![Pasted image 20251117215823](第六章——链路层/Pasted%20image%2020251117215823.png)
接下来，接收方在收到数据帧后，判断二进制数据1的个数就好
而且很容易就能想到，如果发生了多次差错，让数据帧变换一圈后，还是偶数个1，这样就导致差错没有检验出来
### 二维奇偶校验
同样是纠正单个比特的错误，其每一行在单比特奇偶校验的基础上，对每一行，每一列的二进制信息都设置一个校验位
![Pasted image 20251121160151](第六章——链路层/Pasted%20image%2020251121160151.png)
此时接收方在收到信息后，就会检验每一行，每一列的校验码，如果个比特出错，那么对应的一个行校验码和列校验码都会出错，利用行列信息就能定位错误

### 因特网检查和
![Pasted image 20251121160815](第二章——应用层/Pasted%20image%2020251121160815.png)

### 循环冗余校验
![Pasted image 20251121160838](第六章——链路层/Pasted%20image%2020251121160838.png)
![Pasted image 20251121160845](第六章——链路层/Pasted%20image%2020251121160845.png)

# 多路访问链路和协议

## 两种链路

### 点到点链路
PPP/以太网交换机和主机之间的点到点链路
这个链路只能从一个确定的设备发出，被一个确认的设备接收
### 广播链路
传统以太网/802.11无线LAN
广播链路允许多个设备访问同一个通信链路，当一个设备发送信息，在这个链路上的其他设备也能接收到

如果有两个及以上设备同时发送信息，就会导致相互干扰
#### 多址访问协议
多址访问协议是链路层的协调算法，保证设备稳定有序在共享信道传输信息
由于前面提到了，多个设备同时传输会互相干扰，所以我们得想一个办法，让这些设备有序不干扰地传输信息，怎样合理地共享这个信道
所以我们采用多址访问协议来控制设备什么时候发送信息，同时，这个协议地信息也是通过共享信道传输的
##### 理想的多址访问协议
![Pasted image 20251121162756](第六章——链路层/Pasted%20image%2020251121162756.png)
接下来说几种多址访问协议
##### 信道划分协议
###### TDMA（Time Division Mutiple Access）
也就是时分协议
![Pasted image 20251121164041](第六章——链路层/Pasted%20image%2020251121164041.png)
###### FDMA（Frequence Division Mutiple Access）
也就是频分协议
![Pasted image 20251121164120](第六章——链路层/Pasted%20image%2020251121164120.png)
#####  随机访问协议
![Pasted image 20251121164153](第六章——链路层/Pasted%20image%2020251121164153.png)
###### ALOHA（Additive Link On-Line Hawaii system）![Pasted image 20251208150904](../../../Pasted%20image%2020251208150904.png)
这是第一个无线计算机网络
![Pasted image 20251121164740](第六章——链路层/Pasted%20image%2020251121164740.png)
纯ALOHA
发送方在发送数据后会监听信道，检查发送的信息是否受损（即信道是否冲突）
如果检查到冲突，则其会在一个随机的时间段之后重发信息，再重复上面的过程
比如下面的过程
![Pasted image 20251121165447](第六章——链路层/Pasted%20image%2020251121165447.png)
t表示了一个时间轴，再某个是节点，站1到站n都可能尝试发送信息
t轴上的每个方格都是数据帧，而方格的长度表示数据帧发送的时间
可见，站1发送数据帧1后，其他站没有发送数据帧，即不冲突，数据帧1发送成功
一段时间之后，站2发送了数据帧2，可见，在数据帧2传输的末端，站N - 1传输了数据帧3，同时传输导致这两个数据帧都破损了，两者都要在一个时间段后重发
于是站2过了一段时间重发这个数据帧，即图上的5，而此时站1又发了一个新的数据帧，两者冲突，导致都要重发
站N - 1就比较幸运了，其重发了数据帧3，也就是图中的7时，没有其他站发送数据帧，数据帧被完好地传输了
纯ALOHA的工作效率如下：
首先，我们将传输的时间按一个标准数据帧的时间分块，一个标准数据帧传输的时间是1，那么对于在$t_0$发送的数据帧a来说，想要实现不碰撞，得有下面两个客观条件：
1. $t_0 - 1$到$t_0$之间，不能有数据帧传输，否则会出现这个数据帧没传完， a开始传输导致碰撞
2.  $t_0$到$t_0 + 1$之间不能有数据帧传输，否则数据帧a没有传输完，就有新的数据帧传输导致碰撞
![Pasted image 20251121170044](第六章——链路层/Pasted%20image%2020251121170044.png)


时隙ALOHA
相比前面的纯ALOHA，有了一点规矩
其将传输时间分成了等长的时间段，时间段的长度正好是传输一个数据帧所用时间，我们称这个时间段为时隙
对于每个想发送信息的主机，必须在某个时隙开始的时候发送
如果有多个站在同一时隙发送，就会发生冲突，检测到冲突的站会以概率p在未来的每个时隙开始时发送数据帧，知道发送成功
流程如下：
![Pasted image 20251121170758](第六章——链路层/Pasted%20image%2020251121170758.png)

###### CSMA（Carrier Sense Multiple Access） 载波监听多址接入
这种管理方式主张在传输前监听整个信道，如果信道空闲，则传送整个帧，如果信道有人在传输，则推迟传送
非坚持CSMA
一旦监听到信道忙，就会不再监听，根据协议的算法延迟一个随机的时间之后重新监听

时隙非坚持CSMA
采用划分时隙的随机接入CSMA协议，规定只在每个时隙开始时监听

1坚持CSMA
如果信道正忙，则持续等待，知道信道空闲，就将数据送出，如果送出后发现和其他设备发送的信息冲突，就等待随机长的时间，然后重新开始

P坚持CSMA
如果信道正忙，则将持续等待直到信道空闲，以概率P发送这个数据，1-P的概率延迟一段时间（这个时间为网络中最远的端到端时延），重新监听信道，重复上个过程
![Pasted image 20251121205158](第六章——链路层/Pasted%20image%2020251121205158.png)

CSMA的碰撞检测：CSMA/CD
怎样检测多份数据同时发送，造成的冲突碰撞
![Pasted image 20251121205601](第六章——链路层/Pasted%20image%2020251121205601.png)
下面分析一个实例
现假设AB两设备距离1km，共用一个信道互相传递信息
在t = 0的时刻，A向B发送了一个数据帧
我们假设一个数据帧完全传输的用时时τ
而在 τ - φ的时点，B也给A发了一个数据帧，我们很容易能知道：两者会发生冲突，因为A还没传输完他的数据帧
![Pasted image 20251121210325](第六章——链路层/Pasted%20image%2020251121210325.png)
不过，此时两波数据还未正式发生碰撞
在 t = τ - φ / 2的时刻，两拨数据帧发生碰撞，按理说，此时这两个数据都已经损坏了
![Pasted image 20251121210514](第六章——链路层/Pasted%20image%2020251121210514.png)
接下来，A传输的信息被B接收，而正在传输数据帧的B发现来自A的信息，而且这个信息是损坏的，B立刻明白了发生了冲突，此时B立刻停止继续传输自己的数据帧。空留一部分不完整而且损坏的数据帧发往A
![Pasted image 20251121210636](第六章——链路层/Pasted%20image%2020251121210636.png)
A接收到这个损坏而且不完整的数据帧后，也明白了发生了碰撞，也停止自己数据帧的传输
![Pasted image 20251121210711](第六章——链路层/Pasted%20image%2020251121210711.png)

强化碰撞——额外手段
![Pasted image 20251121210739](第六章——链路层/Pasted%20image%2020251121210739.png)
![Pasted image 20251121210811](第六章——链路层/Pasted%20image%2020251121210811.png)


争用期
对于最先发送数据帧的栈来说，发送数据帧之后吗，最多经过时间2τ（两倍的往返时延，往极限了想，当A发送的数据到达b的瞬间，B往a发送了数据，此时那一瞬间造成了数据损坏，而整个信息运行的时间，为A传输数据到B的时间 + B传输数据到A的时间）

我们称以太网端到端往返时延2τ为争用期，或者说碰撞窗口，只要这段时间过去后还是没有碰撞发生的消息，就能肯定当前传输的数据不会再造成碰撞
##### 轮流协议

###### 轮询协议
我们会设置一个设备（无线基站，蓝牙主设备等）为主节点，其余节点为从节点
主节点会一次向网络内的每个从节点发送报文，询问是否有信息要发送，对于从节点来说，这个询问报文不到达就不会发送信息，如果询问到自己而自己没有信息要发送时，就会跳过
![Pasted image 20251121211619](第六章——链路层/Pasted%20image%2020251121211619.png)

缺陷：
- 轮询开销：主节点向从节点发送询问报文也是占用带宽的
- 等待时间，主节点询问报文发送是有时间的，如果多个设备都无信息发送，则这很多段发送时间就被浪费掉了，而在后面真正有消息要发送的主机来说，要额外等很多时间，知道询问报文发到自己才能发消息
- 单点失效：在这个系统中，主节点掌发送信息的规矩，如果主节点瘫痪了，那么整个系统就瘫痪了

令牌（Token）传递协议——击鼓传花
令牌传递协议不再需要主节点挨个询问，而是在互联网内主机之间传输控制令牌，只有手里拿着这个令牌的主机，才能发送消息，而在这个消息发送完之后，这个主机会把令牌传给下一个主机
而令牌也是一个报文，意味着会增大信息传输的开销
![Pasted image 20251121212430](第六章——链路层/Pasted%20image%2020251121212430.png)
缺陷：
- 令牌的开销
- 等待时间：令牌的传递也是需要时间的，哪怕连续几个主机都没有信息要发送，令牌在几个主机之间传递也是消耗时间的
- 单点失效：虽然没有主节点这一说，但是令牌（Token）可能在传递过程中损坏或丢失，导致所有主机都因为没有令牌而无法传递信息，这需要复杂的程序选举，重新产生令牌

#### 总结
![Pasted image 20251121212530](第六章——链路层/Pasted%20image%2020251121212530.png)


# 局域网 LAN
WLAN指无线局域网
指的是较小的物理范围内，将各种计算机、外部设备（如打印机）和数据库系统互联起来的计算机通信网络

## MAC地址
在数据链路层标识每块网络适配器（网卡）让其能在广播信道上寻址目标节点
MAC地址写在网卡的ROM（只读内存里），一旦出厂就无法更改
### 组成
供48比特
前24比特由IEEE分配管理，称为OUI号
后24比特由厂商自行分配
### 和IP地址的比较
![Pasted image 20251121213910](第六章——链路层/Pasted%20image%2020251121213910.png)
## 地址解析协议（ARP）
根据目标的IP地址获取到MAC地址
ARP协议会在更高层访问到这个IP对应的MAC地址是什么，在收到结果后，将其按一定格式保存到ARP高速缓存中,称为IP/MAC地址映射
存储格式如下：<IP；MAC；TTL>（TTL指的是地址映射的有效时间，一般为20分钟。当超过TTL后，这个地址映射就会被删除，需要重新利用ARP协议得到映射）

这时你可能会想：对方的MAC地址都不知道，那这ARP怎么传到对方那里啊？
当然是广播了
![Pasted image 20251121214445](第六章——链路层/Pasted%20image%2020251121214445.png)

首先，需要得到映射信息的主机y广播一条含有已知的ip，未知的MAC的报文，供所有主机接收
这个报文的主要内容是：**Who has 192.168.1.1? Tell 192.168.1.100**  我们在 wireshark抓包时也会看到这个东西
其次，拥有这个ip的设备，就会像主机y发送完整的ARP应答：告诉对方自己的MAC地址，在收到这个地址之后，主机Y就会将映射保存到高速缓存中
![Pasted image 20251121214931](第六章——链路层/Pasted%20image%2020251121214931.png)
![Pasted image 20251121214941](第六章——链路层/Pasted%20image%2020251121214941.png)

### 路由到其他的局域网（同一个路由器的不同接口）
就经过一次路由器呗，反正目标ip是知道的，对方在哪个子网里也好找，无非就是传输过程经过了一次路由器
![Pasted image 20251121215631](第六章——链路层/Pasted%20image%2020251121215631.png)

### 在互联网环境之下的ARP
首先澄清一个事情，所谓互联网之下的广播查询，本质上是在查询当前网关路由器的地址，只要你把信息发送到网关路由器，那么之后的事情就不用你操心了
![Pasted image 20251121220451](第六章——链路层/Pasted%20image%2020251121220451.png)
对于这个系统来说，主机Y想要将信息发送给主机z，通过比较自己和目标的ip和子网掩码，主机y知道了，目标不在自己的子网中，那么，他就会转头找网关路由器对应端口的ip地址
接着就是内网ARP的流程，找到了网关路由器的端口，接下来，其就会向路由器发送想发给主机z的信息
其报头含有下面的信息：
![Pasted image 20251121220930](第六章——链路层/Pasted%20image%2020251121220930.png)
虽然知道最后的目标是主机Z，但是下一步的MAC地址写的是路由器1
而路由器1在收到这个报文后，知道这个IP是外网的ip（对于上图来说，默认路由器12都是网关路由器了），而网关路由器在收到数据帧后，会按同样的方法将报文发给目标子网的网关的路由器2，而路由器再转发到目标主机

总结一下：ARP广播寻址依旧没有广播到自己的子网之外，而是利用联系着子网的网关路由器，作为代理往外网转发自己的消息

如果直接尝试在发送的数据帧里硬塞主机Z的mac地址，那么整个内网的所有设备都会因为不认识这个MAC地址而拒收这个数据帧，那么这个数据帧还没出这个子网就夭折了
## 以太网概述
一种符合IEEE802.3系列标准的一组计算机网络技术，规定了物理层和数据链路层的信息传输标准
![Pasted image 20251121221703](第六章——链路层/Pasted%20image%2020251121221703.png)

### 以太网的类型
#### 总线式以太网
![Pasted image 20251121221740](第六章——链路层/Pasted%20image%2020251121221740.png)

#### 交换式以太网
![Pasted image 20251121221753](第六章——链路层/Pasted%20image%2020251121221753.png)

### 以太网的帧结构
![Pasted image 20251122160633](第六章——链路层/Pasted%20image%2020251122160633.png)
这是头部字段
- 前同步码：总共八字节，前七字节的格式是：10101010，最后一个字节的格式是：10101011，0和1交替形成标准的方波，保证接收方和发送方传输和接收信息的频率是一样的（相同时间内，发送方能发送两个比特而接收方只能接收一个，导致发送方一次发送的第二个比特丢失），而最后一个连续的11，是同步码结束的标志。同步码的作用是统一接收方和发送方的时钟，保证发送和接收同步
- 地址：6字节，存储的是这个数据帧发送对象的mac地址，如果接收方符合这个mac地址，那么接收方就会解包并把信息传递给上层，如果接收方不是这个mac地址，而且这个mac地址不是广播，则在链路层层面就会把这个数据帧丢弃
- 源地址，指的就是发送方的mac地址
- 类型：上层协议类型（网络层协议类型，大部分是IP协议）
- CRC：检查码，用于判断信息是否受损，前面提到过了
正文就是整个数据帧的数据字段，整个数据字段的长度从46字节（头部字段长度18字节，链路层要求以太网帧总长度不小于64字节（后面的最短有效帧长会解释这个事情），64 - 18 = 46）到1500字节

### 以太网提供的服务
![Pasted image 20251122162057](第六章——链路层/Pasted%20image%2020251122162057.png)
### 以太网使用的CSMA/CD
![Pasted image 20251122162117](第六章——链路层/Pasted%20image%2020251122162117.png)
#### 具体算法
![Pasted image 20251122162213](第六章——链路层/Pasted%20image%2020251122162213.png)
拥塞信号：用来确保所有传输者都能检测到碰撞而传输的信号，48比特长
比特时间：传输1bit数据所需的时间，在10Mbps的以太网中 当K = 1023 等待时间大约为50ms

#### 指数回退算法
有的时候，可能传输一个数据帧，你传一次冲突一次，传一次冲突一次，这就需要一种算法来优化你的重传策略，这就是指数回退算法
因为你只知道当前线路是否冲突，对这个线路忙成什么样没有具体的把握，这个算法就是在重传时试图估计链路正确的负载
首先，在我们第一次发生碰撞的时候，有两个时间节点{0，1}供发送方随机选择，加入随机了一个时间点a，我们在a时刻后重传，又发生碰撞了
这时，时间节点的选择范围翻倍成{0，1，2，3}，发送方将会在这四个选项里随机选择一个时间节点发送信息
如果还是冲突，则再将这个范围翻倍……
可见，时间范围的长度就能体现当前链路的繁忙程度

![Pasted image 20251122163110](第六章——链路层/Pasted%20image%2020251122163110.png)
![Pasted image 20251122163117](第六章——链路层/Pasted%20image%2020251122163117.png)

### 传统以太网的物理层
![Pasted image 20251122163235](第六章——链路层/Pasted%20image%2020251122163235.png)

## 信号编码
就是怎样把0 和 1在物理层面表示出来用于传播，能用来传播的东西有很多，网线啊，光纤啊，无线电波啊，有光能，有电能还有别的，我们的任务是给他们安排一个共通的传播数据的形式
下面解释的是电平的变化表示数据
### NRZ编码
很直白，高电平就是1，低电平就是0
![Pasted image 20251122164549](第六章——链路层/Pasted%20image%2020251122164549.png)
### 曼彻斯特编码
规定一个中间电平，还有高电平和低电平
那么电平变化有下面几种形式：
	电平由低电平跳到高电平表示0，由高电平跳到低电平表示1
![Pasted image 20251122164653](第六章——链路层/Pasted%20image%2020251122164653.png)
#### 中间跳变
通过图片可以看到：如果存在连续的0（或1），在传输下一个比特的数据时，电平会先跳到低电平，再从低电平跳到高电平表示0
所以，真正判断传输的数据是0还是1的依据，是传输1比特数据的中间时间段的电平变化情况

#### 差分曼彻斯特编码
和曼彻斯特编码不同，表示0和1的方式不再是看点位跳变的方向，而是判断电位是否跳变
![Pasted image 20251125202627](第六章——链路层/Pasted%20image%2020251125202627.png)
由图片可知，判断跳变的节点不是在某个中间时间段，而是在两个比特时间段交接的地方判断，如果发生了电位变化，就说明传输的是1，如果没发生变化，则说明传输的是0，若中间时间段发生了点位变化则不会被判断、


## 集线器（转发器）互联
集线器，一种在物理层工作的网络设备，将从某个数据端口收到的信号（比特流）放大，并转发给其他所有接口（已经被更智能的交换机淘汰了）
在这种物理环境下，链路层是这样工作的
![Pasted image 20251125203242](第六章——链路层/Pasted%20image%2020251125203242.png)
这个主干集线器，将局域网段（每三个主机组成的那个小网络）互连起来

这种模式能够扩大节点之间的传输距离：对于10BaseT集线器来说，其传输距离通常是100米，但是先将信号发给主干集线器，经过其放大和转发，就能传到更远的局域网段
但是，这样也带来了一些麻烦
将这三个小网段联系起来，就意味着他们被合并在了同一个“主线”下传递信息，原来碰撞域的作用范围，从各自的三个一组的小网段，到了整个9个电脑，也就是说，这九个电脑里任意两个电脑同时传递信息，就会发生冲突
## 网桥互联
一种工作在链路层的存储-转发设备，实现MAC层的局域网互联
![Pasted image 20251125204259](第六章——链路层/Pasted%20image%2020251125204259.png)
其内部是这样的
![Pasted image 20251125204340](第六章——链路层/Pasted%20image%2020251125204340.png)
其含有两个端口（至少这款网桥），其会不断监听两个端口是否收到对应局域网的信息，如果收到了信息，先回检查完整性，如果不完整则丢弃。接着会检查数据帧前部保存的目标和来源mac地址，和内部的站表对照，搜索这两个mac地址分别在哪个端口下：
	如果目标和来源mac在一个端口下，也就是在相同的局域网之下，网桥会直接丢弃这个数据帧，如果来自不同的端口，也就是不同的局域网，则网桥会把这个数据帧通过目标端口转发到目标局域网

### 网桥的优势
扩大了局域网的物理范围，让两个小局域网能通过网桥传递信息
过滤通信量
提高了可靠性
可以和不同的物理层，mac子层以及不同速率的局域网互联（我只负责转发，让我的报文能在局域网里被理解和传播就行，至于这几个局域网内部构造到底怎么样和我无关）

### 网桥的缺点
涉及接收和转发带来的时延
如果某段时间传播的数据帧，网桥的缓存可能溢出，导致帧丢失（类似丢包）
不同的mac子层的局域网段桥接时，在转发时需要修改数据帧的某些字段导致时间消耗
广播风暴：传播的广播的信息太多导致网络拥塞

### 网桥和集线器的区别
![Pasted image 20251125205213](第六章——链路层/Pasted%20image%2020251125205213.png)

## 透明网桥
一种特殊的网桥
“透明体现在”：局域网的主机不知道发送的帧到对方需要经过哪几个网桥，它只知道在当前局域网广播，就能把信息送到对方那里

### 选路原理
![Pasted image 20251125205459](第六章——链路层/Pasted%20image%2020251125205459.png)

### 透明网桥的问题——兜圈子
![Pasted image 20251125205854](第六章——链路层/Pasted%20image%2020251125205854.png)
根据图片，现有两个局域网，这两个局域网要通过两个网桥来传递信息
现在主机A广播发送了一个信息（目标mac地址是FF:FF:FF:FF:FF:FF），其在广播过程中通过网桥2被发到局域网2，而这个数据帧在通过网桥2转发到局域网2并广播后，进入了网桥1，而网桥1不认识这个数据帧，就直接把这个信息送回局域网1并广播了，而这个数据帧在局域网1广播的过程中，又进入了网桥2，又被发到了局域网2…………这个数据帧一直在网络中传播，随着A发的数据帧越来愈多，这个网络的信息传递负担会越来越重

#### 解决方案——支撑树算法
![Pasted image 20251125210414](第六章——链路层/Pasted%20image%2020251125210414.png)


## 以太网交换机——多端口网桥
和前面提到的只包含两个端口的网桥不同，这种网桥支持多个端口互联，将更多网段联系起来
这样的多端口网桥同样是链路层设备，从任意端口接收到来的数据帧，并根据MAC地址转发到合适的网段，注意，这种多端口网桥同样使用CSMA/CD来访问LAN网段

### 以太网交换机和路由器的比较
两者的作用都是将到来的信息进行存储和转发的操作
只不过所属的层次不一样
![Pasted image 20251202175451](第六章——链路层/Pasted%20image%2020251202175451.png)![Pasted image 20251202175531](第六章——链路层/Pasted%20image%2020251202175531.png)


## 虚拟局域网VLAN
指的是通过软件方式来实现逻辑工作组划分和管理的一种网络工作组组件技术
也就是说，只要一群机器能够相互通信，无论他们身处何方，是不是在一个局域网之下，都将他们视作一个整体，可以再将其细化分组，之后的分组就是虚拟局域网

### 虚拟局域网的特征
- 局域网交换机是组建局域网的核心设备
- 组成逻辑工作组的节点不受物理位置限制
- 当一个节点从逻辑工作组换到另一个逻辑工作组的时候，只要在软件层面实现修改就好，无需在显示物理层面做出任何改变
大概就像这样
![Pasted image 20251202180127](第六章——链路层/Pasted%20image%2020251202180127.png)
构建方式：基于交换机端口号，MAC地址和IP地址


# 链路虚拟化，网络作为链路层
其实链路虚拟化更像链路层的上层的东西，其核心就是在已经搭建好链路的基础上，通过软件控制及逻辑层面的方式实现一些链路层的特性和功能，类似虚拟机一样，在已有的物理机的基础上，通过逻辑计算实现模拟出一个电脑
## 多协议标签交换 （MPLS）
一种在电信网络用于加速和管理网络流量的数据传输机制，能在支持MPLS的路由器网络之间实现高速转发
### 标签
MPLS协议的标签保存在链路层以太网（或ppp）首部和IP首部之间
![Pasted image 20251204101641](第六章——链路层/Pasted%20image%2020251204101641.png)
包含标签，实验，S，TTL四个部分

### 具有MPLS功能的路由器 AKA标签交换路由器
这种路由器仅根据1标签值将数据包转发到输出接口，不检查IP地址
![Pasted image 20251204102001](第六章——链路层/Pasted%20image%2020251204102001.png)

# 数据中心网络
略
